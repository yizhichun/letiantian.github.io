<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="乐天笔记, 樂天笔记, 编程" />





  <link rel="alternate" href="/atom.xml" title="樂天笔记" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/content/images/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="樂天笔记">
<meta property="og:url" content="http://www.letiantian.me/page/9/index.html">
<meta property="og:site_name" content="樂天笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="樂天笔记">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.letiantian.me/page/9/"/>





  <title>樂天笔记</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <img class='bg-image' src="/content/images/bg.jpg" />

  







  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=62535551";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>









  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">樂天笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-topics">
          <a href="/topics" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-flask"></i> <br />
            
            专题
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-11-02-find-the-maximum-number-of-occurrences-of-elements-in-array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-11-02-find-the-maximum-number-of-occurrences-of-elements-in-array/" itemprop="url">如何找到数组中出现次数最多的元素</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-11-02T23:19:16+08:00">
                November 2nd 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-11-02</p>
<p>之前，有在<a href="/2014-09-08-find-repeating-elements-in-array">如何找出数组中重复的元素</a>整理过如何找数组中找到重复出现的数字。</p>
<p>今天遇到这样一个需求，数组中所有的元素的值都在<code>[0,8]</code>之间，且都是整数，我需要找出出现次数最多的元素。这个问题可以用<a href="/2014-09-08-find-repeating-elements-in-array">如何找出数组中重复的元素</a>提出的方法来解决，我是使用位向量的方法来解决的，算法的时间复杂度为[latex]O(n) [/latex]，代码如下：</p>
<pre><code># !/usr/bin/env python
# -*- encoding:utf-8 -*-

arr = [0, 2, 5, 6, 1, 0, 1, 4, 1]

def get_max_occur_number(arr):
    vector = [0] * len(arr) 
    for n in arr:
        vector[n] += 1
    max_occur_number = max(vector) # vector中的最大值
    return vector.index(max_occur_number)  # 最大值的位置


if __name__ == &#39;__main__&#39;:
    print get_max_occur_number(arr)
</code></pre><p>运行结果输出<code>1</code>。</p>
<p>我在谷歌上搜索了该问题，发现这个问题的两个扩展。</p>
<p><strong>第1个扩展：</strong>要求时间复杂度为[latex]O(n)[/latex]，且不使用辅助空间。在开源中国社区的讨论区中，<a href="http://www.oschina.net/question/102557_129175?sort=default&amp;p=1" target="_blank" rel="external">一道数组面试题-不能使用辅助空间找重复次数的数</a>给出了多种解法，都很有技巧性，甚至是<strong>太有技巧了</strong>，不过有一个解法简单：</p>
<pre><code>for i in lst:
  lst[i%100] += 100

lst = map(lambda x: x/100, lst)

print lst.index(max(lst))
</code></pre><p>添加到我上面的代码：</p>
<pre><code># !/usr/bin/env python
# -*- encoding:utf-8 -*-

def get_max_occur_number(arr):
    for i in arr:
        arr[i%100] += 100 # 或者arr[i] += 100
    print arr
    arr = map(lambda x: x/100, arr) # arr每个元素除以100
    print arr
    return arr.index(max(arr))


if __name__ == &#39;__main__&#39;:
    arr = [0, 2, 5, 6, 1, 0, 1, 4, 1]  # 每个元素是整数
    print arr
    print get_max_occur_number(arr)
</code></pre><p>其实，就是在原先的数组中使用位向量的方法。上面代码的运行结果：</p>
<pre><code>[0, 2, 5, 6, 1, 0, 1, 4, 1]
[200, 302, 105, 6, 101, 100, 101, 4, 1]
[2, 3, 1, 0, 1, 1, 1, 0, 0]
1
</code></pre><p>把<code>[200, 302, 105, 6, 101, 100, 101, 4, 1]</code>中前9个元素（因为数组中所有的元素的值都在<code>[0,8]</code>之间）每个元素的个位数和十位数删掉，就是相应的数字的出现次数。</p>
<p><strong>第2个扩展：</strong>求出现次数最多的最大数。也就是说可能有多个数出现的次数都是最多的，取最大的数字，这个很简单，不介绍了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-28-logistic-regression-python-implement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-28-logistic-regression-python-implement/" itemprop="url">逻辑斯谛回归代码实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-28T13:32:30+08:00">
                October 28th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-28</p>
<p>在<a href="https://github.com/yusugomori/DeepLearning" target="_blank" rel="external">https://github.com/yusugomori/DeepLearning</a>包含了多种编程语言版本（C、C++、Python、Java、scala）的<strong>逻辑斯谛回归（或者“逻辑回归”， Logistic Regression）</strong>的实现。</p>
<p>我对python版本的代码略做整理和注释，最终内容如下：</p>
<pre><code class="python"># !/usr/bin/env python
# -*- coding: utf-8 -*-

&#39;&#39;&#39;
 Logistic Regression

 References :
   - Jason Rennie: Logistic Regression,
   http://qwone.com/~jason/writing/lr.pdf

   - DeepLearningTutorials
   https://github.com/lisa-lab/DeepLearningTutorials

&#39;&#39;&#39;

&#39;&#39;&#39;
该代码原始版本在：https://github.com/yusugomori/DeepLearning
&#39;&#39;&#39;

import sys
import numpy
numpy.seterr(all=&#39;ignore&#39;)


def sigmoid(x):
    return 1. / (1 + numpy.exp(-x))


def softmax(x):
    e = numpy.exp(x - numpy.max(x))  # prevent overflow；numpy.max(x)取矩阵中的最大值，结果是一个数字
    if e.ndim == 1:  # 一维空间，即e为向量
        return e / numpy.sum(e, axis=0)
    else:     # 二维空间
        return e / numpy.array([numpy.sum(e, axis=1)]).T  # axis -&gt; 每一行求和


class LogisticRegression(object):
    def __init__(self, input, label, n_in, n_out):
        self.x = input
        self.y = label
        self.W = numpy.zeros((n_in, n_out))  # initialize W 0； 权重矩阵初始化为0，n_in-&gt;样本特征数，n_out-&gt;类别数。
        self.b = numpy.zeros(n_out)          # initialize bias 0； 偏置项初始化为0，

        # self.params = [self.W, self.b]

    def train(self, lr=0.1, input=None, L2_reg=0.00):

        # L2_reg，是L2正则化下的惩罚系数；正则化，即“惩罚”，数越大，惩罚力度越大，
        # http://sobuhu.com/ml/2012/12/29/normalization-regularization.html

        if input is not None:
            self.x = input

        # p_y_given_x = sigmoid(numpy.dot(self.x, self.W) + self.b)
        p_y_given_x = softmax(numpy.dot(self.x, self.W) + self.b) # 样本特征构成的矩阵×权重矩阵+偏置项
        d_y = self.y - p_y_given_x  # delta y

        self.W += lr * numpy.dot(self.x.T, d_y) - lr * L2_reg * self.W
        self.b += lr * numpy.mean(d_y, axis=0)

        # cost = self.negative_log_likelihood()
        # return cost

    def negative_log_likelihood(self):

        # 交叉熵：http://en.wikipedia.org/wiki/Cross_entropy

        # sigmoid_activation = sigmoid(numpy.dot(self.x, self.W) + self.b)
        sigmoid_activation = softmax(numpy.dot(self.x, self.W) + self.b)

        cross_entropy = - numpy.mean(
            numpy.sum(self.y * numpy.log(sigmoid_activation) +
            (1 - self.y) * numpy.log(1 - sigmoid_activation),
                      axis=1))

        return cross_entropy


    def predict(self, x):
        # return sigmoid(numpy.dot(x, self.W) + self.b)
        return softmax(numpy.dot(x, self.W) + self.b)


def test_lr(learning_rate=0.01, n_epochs=200):
    # training data
    x = numpy.array([[1,1,1,0,0,0],
                     [1,0,1,0,0,0],
                     [1,1,1,0,0,0],
                     [0,0,1,1,1,0],
                     [0,0,1,1,0,0],
                     [0,0,1,1,1,0],
                     [0,0,0,0,0,1],
                     [0,0,0,0,0,1]])
    y = numpy.array([[1, 0, 0],  # 类0
                     [1, 0, 0],  # 类0
                     [1, 0, 0],  # 类0
                     [0, 1, 0],  # 类1
                     [0, 1, 0],  # 类1
                     [0, 1, 0],  # 类1
                     [0, 0, 1],  # 类2
                     [0, 0, 1]]) # 类2


    # construct LogisticRegression
    classifier = LogisticRegression(input=x, label=y, n_in=6, n_out=3)

    # train
    for epoch in xrange(n_epochs):
        classifier.train(lr=learning_rate, L2_reg=1.)
        # cost = classifier.negative_log_likelihood()
        # print &gt;&gt; sys.stderr, &#39;Training epoch %d, cost is &#39; % epoch, cost
        learning_rate *= 0.95


    # test
    # x = numpy.array([[1, 1, 0, 0, 0, 0],
    #                  [0, 0, 0, 1, 1, 0],
    #                  [1, 1, 1, 1, 1, 0]])
    # print x.shape
    predict = classifier.predict(x)

    print predict
    print numpy.argmax(predict, axis=1) # 每一行最大数的位置
    print classifier.negative_log_likelihood()


if __name__ == &quot;__main__&quot;:
    test_lr()
</code></pre>
<p>运行<code>test_lr()</code>函数的结果如下：</p>
<pre><code>[[ 0.56100127  0.25894207  0.18005667]
 [ 0.48722535  0.30494234  0.20783232]
 [ 0.56100127  0.25894207  0.18005667]
 [ 0.25894207  0.56100127  0.18005667]
 [ 0.30494234  0.48722535  0.20783232]
 [ 0.25894207  0.56100127  0.18005667]
 [ 0.29463485  0.29463485  0.41073029]
 [ 0.29463485  0.29463485  0.41073029]]
[0 0 0 1 1 1 2 2]
1.26403157582
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-22-mahout-naive-bayes-newsgroups/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-22-mahout-naive-bayes-newsgroups/" itemprop="url">使用mahout下的朴素贝叶斯分类器对新闻分类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-22T11:58:06+08:00">
                October 22nd 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-22</p>
<p>mahout版本是0.9；hadoop版本是1.2.1。</p>
<p>下载数据集<a href="http://people.csail.mit.edu/jrennie/20Newsgroups/20news-bydate.tar.gz" target="_blank" rel="external">20 newsgroups dataset</a>，解压后得到<code>20news-bydate</code>目录：</p>
<pre><code>$ cp -R 20news-bydate/*/* 20news-all
</code></pre><p>在<code>20news-all</code>目录下，一个子目录代表一个分类，每个分类下有多个文本文件，每个文本文件代表一个样本。</p>
<p>然后，复制到hdfs中：</p>
<pre><code>$ hadoop  distcp file:///home/sunlt/20news-all 20news-all
</code></pre><p>查看一下：</p>
<pre><code>$ hadoop  dfs -ls                                              
Warning: $HADOOP_HOME is deprecated.

Found 6 items
......
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 10:09 /user/sunlt/20news-all
......
</code></pre><h2 id="转换成的序列文件："><a href="#转换成的序列文件：" class="headerlink" title="转换成的序列文件："></a>转换成<text,text>的序列文件：</text,text></h2><hr>
<pre><code>$ mahout seqdirectory \                 
-i 20news-all \
-o 20news-seq \
-ow
</code></pre><h2 id="转换成-lt-Text-VectorWritable-gt-的序列文件："><a href="#转换成-lt-Text-VectorWritable-gt-的序列文件：" class="headerlink" title="转换成&lt; Text, VectorWritable &gt;的序列文件："></a>转换成&lt; Text, VectorWritable &gt;的序列文件：</h2><hr>
<pre><code>$ mahout seq2sparse -i 20news-seq -o 20news-vectors -lnorm  -nv -wt tfidf
</code></pre><p>此处使用了<a href="https://mahout.apache.org/users/classification/bayesian.html" target="_blank" rel="external">TF-IDF（词频-逆文档频率）</a>生成向量，也可以指定为<code>TF</code>。</p>
<p>更多参数，可以使用<code>mahout seq2sparse --help</code>查看。</p>
<h2 id="拆分数据"><a href="#拆分数据" class="headerlink" title="拆分数据"></a>拆分数据</h2><hr>
<p>将60%的数据用于训练，40%的数据用于测试。</p>
<pre><code>$ mahout split \
        -i 20news-vectors/tfidf-vectors \
        --trainingOutput 20news-train-vectors \
        --testOutput 20news-test-vectors  \
        --randomSelectionPct 40 \
        --overwrite --sequenceFiles -xm sequential
</code></pre><p>此时：</p>
<pre><code>$ hadoop dfs -ls                                                         
Warning: $HADOOP_HOME is deprecated.

Found 10 items
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 09:52 /user/sunlt/20_newsgroups
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 10:09 /user/sunlt/20news-all
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 10:28 /user/sunlt/20news-seq
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 11:17 /user/sunlt/20news-test-vectors
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 11:17 /user/sunlt/20news-train-vectors
drwxr-xr-x   - sunlt supergroup          0 2014-10-13 10:55 /user/sunlt/20news-vectors
</code></pre><h2 id="训练："><a href="#训练：" class="headerlink" title="训练："></a>训练：</h2><hr>
<pre><code>$ mahout trainnb \
        -i 20news-train-vectors\
        -el  \
        -o model \
        -li labelindex \
        -ow \
        -c
</code></pre><h2 id="测试训练好的贝叶斯分类器："><a href="#测试训练好的贝叶斯分类器：" class="headerlink" title="测试训练好的贝叶斯分类器："></a>测试训练好的贝叶斯分类器：</h2><hr>
<pre><code>$ mahout testnb \
        -i 20news-test-vectors \
        -m model \
        -l labelindex \
        -ow \
        -o 20news-testing  \
        -c
</code></pre><p>运行结果：</p>
<pre><code>.......
=======================================================
Summary
-------------------------------------------------------
Correctly Classified Instances          :       3023       93.7946%
Incorrectly Classified Instances        :        200        6.2054%
Total Classified Instances              :       3223

=======================================================
Confusion Matrix
-------------------------------------------------------
a        b        c        d        e        f        g        h        i        &lt;--Classified as
306      1        0        0        1        2        1        1        16        |  328       a     = alt.atheism
0        391      2        1        3        1        0        0        2         |  400       b     = comp.windows.x
0        7        345      6        12       12       2        5        1         |  390       c     = misc.forsale
0        1        2        399      2        1        1        0        0         |  406       d     = rec.motorcycles
0        5        10       2        371      3        0        3        1         |  395       e     = sci.electronics
0        5        0        1        4        371      1        2        1         |  385       f     = sci.med
1        3        0        2        1        1        317      8        0         |  333       g     = talk.politics.guns
1        0        0        1        2        3        11       311      5         |  334       h     = talk.politics.misc
22       1        2        1        0        0        8        6        212       |  252       i     = talk.religion.misc

=======================================================
Statistics
-------------------------------------------------------
Kappa                                       0.9105
Accuracy                                   93.7946%
Reliability                                84.0504%
Reliability (standard deviation)            0.2984
</code></pre><p>对角线代表预测正确的数量。</p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><hr>
<p>导出数据：</p>
<pre><code>$ mahout seqdumper -i 20news-testing/part-m-00000 -o ./20news_testing.res
</code></pre><p>查看：</p>
<pre><code>$ gedit ./20news_testing.res
</code></pre><p>也可以这样查看：</p>
<pre><code>$ hadoop dfs -cat 20news-testing/part-m-00000
</code></pre><p>由于是sequence文件，查看的结果是乱码。</p>
<p>将hdfs中某个目录中的文件拷贝到本地：</p>
<pre><code>$ hadoop dfs -copyToLocal 20news-vectors/* .
</code></pre><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><hr>
<p><a href="http://mahout.apache.org/users/classification/twenty-newsgroups.html" target="_blank" rel="external">Twenty Newsgroups Classification Example</a>  </p>
<p><a href="http://openresearch.baidu.com/platform/494.jhtml;jsessionid=C26F96441F909487F25848BEC300F851" target="_blank" rel="external">贝叶斯分类算法示例</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-19-node-markdown-marked-convert-markdown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-19-node-markdown-marked-convert-markdown/" itemprop="url">使用nodejs的markdown和marked模块解析markdown</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-19T22:16:48+08:00">
                October 19th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-19</p>
<p><a href="https://github.com/evilstreak/markdown-js/" target="_blank" rel="external">markdown-js</a>和<a href="https://github.com/chjj/marked" target="_blank" rel="external">marked</a>这两个模块都支持将mardown解析为html。</p>
<p><strong>安装：</strong></p>
<pre><code>$ npm install markdown
$ npm install marked
</code></pre><h2 id="markdown模块"><a href="#markdown模块" class="headerlink" title="markdown模块"></a>markdown模块</h2><hr>
<p>测试1：</p>
<pre><code># !/usr/bin/env node

var text = &quot;##hello\n&quot;+
    &quot;---\n&quot; +
    &quot;[baidu](http://www.baidu.com)\n&quot; +
    &quot;Hello *World*!&quot;;
var markdown = require( &quot;markdown&quot; ).markdown;
console.log( markdown.toHTML( text ) );
</code></pre><p>运行结果如下：</p>
<pre><code>&lt;h2&gt;hello&lt;/h2&gt;

&lt;hr/&gt;

&lt;p&gt;&lt;a href=&quot;http://www.baidu.com&quot;&gt;baidu&lt;/a&gt;
Hello &lt;em&gt;World&lt;/em&gt;!&lt;/p&gt;
</code></pre><p>测试2：</p>
<p>现在，当前目录下有文件<code>test.md</code>，内容如下：</p>
<pre><code>## Hello
---

01 | 02 |  03
---|------|-----
11 |  12 | 13
23| 34|  43


    print &#39;hello&#39;
</code></pre><p>使用下面的代码处理下<code>test.md</code>的内容：</p>
<pre><code># !/usr/bin/env node

fs = require(&#39;fs&#39;);
markdown = require( &quot;markdown&quot; ).markdown;

fs.readFile(&#39;test.md&#39;, function (err, data) {
  if (err) throw err;
  var markdownContent = data.toString();
  var htmlContent = markdown.toHTML( markdownContent );
  console.log( htmlContent );
});
</code></pre><p>输出如下：</p>
<pre><code>&lt;h2&gt;Hello&lt;/h2&gt;

&lt;hr/&gt;

&lt;p&gt;01 | 02 |  03
---|------|-----
11 |  12 | 13
23| 34|  43&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;print &amp;#39;hello&amp;#39;&lt;/code&gt;&lt;/pre&gt;
</code></pre><p><code>test.md</code>使用了markdown扩展的表格定义，node的<code>markdown</code>模块并没有提供转换表格的功能。</p>
<h2 id="marked模块"><a href="#marked模块" class="headerlink" title="marked模块"></a>marked模块</h2><hr>
<p>使用marked模块解析<code>test.md</code>：</p>
<pre><code># !/usr/bin/env node

fs = require(&#39;fs&#39;);
markdown = require(&#39;marked&#39;);

fs.readFile(&#39;test.md&#39;, function (err, data) {
  if (err) throw err;
  var markdownContent = data.toString();
  var htmlContent = markdown( markdownContent );
  console.log( htmlContent );
});
</code></pre><p>解析结果：</p>
<pre><code>&lt;h2 id=&quot;hello&quot;&gt;Hello&lt;/h2&gt;
&lt;hr&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;01&lt;/th&gt;
&lt;th&gt;02&lt;/th&gt;
&lt;th&gt;03&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;34&lt;/td&gt;
&lt;td&gt;43&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre&gt;&lt;code&gt;print &amp;#39;hello&amp;#39;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>由此可见，marked模块提供的功能更多一些。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-19-ghost-add-duoshuo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-19-ghost-add-duoshuo/" itemprop="url">ghost博客添加多说评论</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-19T11:09:09+08:00">
                October 19th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-19</p>
<p>最近将博客迁移到了ghost上，使用的是<a href="http://ghostium.oswaldoacauan.com/" target="_blank" rel="external">Ghostium Theme</a>。（现在没有用这个主题，2015-06）</p>
<p>首先在多说上获取通用代码：</p>
<pre><code>&lt;!-- 多说评论框 start --&gt;
    &lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;请将此处替换成文章在你的站点中的ID&quot; data-title=&quot;请替换成文章的标题&quot; data-url=&quot;请替换成文章的网址&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;letianbiji&quot;};
    (function() {
        var ds = document.createElement(&#39;script&#39;);
        ds.type = &#39;text/javascript&#39;;ds.async = true;
        ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
        ds.charset = &#39;UTF-8&#39;;
        (document.getElementsByTagName(&#39;head&#39;)[0] 
         || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
    })();
    &lt;/script&gt;
&lt;!-- 多说公共JS代码 end --&gt;
</code></pre><p>将上面代码中的：</p>
<pre><code>&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;请将此处替换成文章在你的站点中的ID&quot; data-title=&quot;请替换成文章的标题&quot; data-url=&quot;请替换成文章的网址&quot;&gt;&lt;/div&gt;
</code></pre><p>修改成：</p>
<pre><code>{{#post}}
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;{{slug}}&quot; data-title=&quot;{{title}}&quot; data-url=&quot;{{url absolute="true"}}&quot;&gt;&lt;/div&gt;
{{/post}}
</code></pre><p>然后将代码复制到主题的<code>post.hbs</code>文件中的恰当位置。</p>
<p>之后，可以考虑清理一下主题中disqus相关的代码。</p>
<p><strong>但是，却出现了令人意外的现象：</strong><br>使用新标签打开一文章，多说评论可以正常显示，但是在当前标签打开一篇文章却无法显示多说评论，需要刷新一次网页才行。</p>
<p>其实，之前mathjax也是出现了这个问题，但是将就着用了。下面的解决过程：</p>
<p>1、花了很长时间（盲目地）查看代码，调整代码位置，都没有用。</p>
<p>2、想到了JQuery Mobile，也许是链接标签<code>&lt;a&gt;</code>的相关事件被劫持，使用ajax来获取页面了。打开firebug，在博客首页打开一文章，查看http请求，果然是。</p>
<p>3、在主题的配置文件<code>./partials/custom/config.hbs</code>中有这么一行：</p>
<pre><code>{{! Enable Pjax for asynchronous (AJAX) content loading}}
var enable_pjax = true;
</code></pre><p>pjax是什么？就是利用ajax刷新页面，同时url也会改变（HTML5特性），这种方式可以减少重复请求。应该是它了，将<code>var enable_pjax = true;</code>改成<code>var enable_pjax = false;</code>，重启ghost。</p>
<p>多说评论和mathjax的问题都解决了。</p>
<p><strong>关于pjax的一些资料：</strong></p>
<p><a href="http://www.zhihu.com/question/20289254" target="_blank" rel="external">pjax 是如何工作的？</a><br><a href="http://www.welefen.com/pjax-for-ajax-and-pushstate.html" target="_blank" rel="external">pjax：ajax和pushState结合的js库</a><br><a href="https://github.com/defunkt/jquery-pjax" target="_blank" rel="external">jquery-pjax</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-17-sublime-text-3-run-nodejs-app/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-17-sublime-text-3-run-nodejs-app/" itemprop="url">如何让sublime text 3运行nodejs程序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-17T21:44:26+08:00">
                October 17th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-17</p>
<p>在linux下，打开目录<code>～/.config/sublime-text-3/Packages/User</code>，创建文件<code>nodejs.sublime-build</code>，内容如下：</p>
<pre><code>{
  &quot;cmd&quot;: [ &quot;nodejs&quot;, &quot;$file&quot; ],
  &quot;selector&quot;: &quot;source.js&quot;
}
</code></pre><p>重新打开sublime text 3，新建文件<code>hello.js</code>，加入以下内容：</p>
<pre><code># !/usr/bin/env node

console.log(&quot;hello world&quot;);
</code></pre><p>在菜单栏中，“Tools”-&gt;“Build System”，选中“Automatic”。<br>使用快捷键<code>CTRL + B</code>，在下侧会弹出一窗口，显示运行结果：</p>
<pre><code>hello world
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-16-hadoop-2-4-1-stand-alone-install-and-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-16-hadoop-2-4-1-stand-alone-install-and-config/" itemprop="url">hadoop2.4.1单机伪分布式安装和配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-16T22:07:34+08:00">
                October 16th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-16</p>
<p>在<a href="http://www.carfab.com/apachesoftware/hadoop/common/stable2/" target="_blank" rel="external">http://www.carfab.com/apachesoftware/hadoop/common/stable2/</a>下找了个稳定的hadoop2.4.1下载了。</p>
<p>我使用的操作系统：linux mint 16, 64位。</p>
<h2 id="配置java和ssh"><a href="#配置java和ssh" class="headerlink" title="配置java和ssh"></a>配置java和ssh</h2><hr>
<p>设置JAVA_HOME等，并配置ssh，使得执行下面的命令不需要确认和输入密码：</p>
<pre><code>$ ssh localhost
</code></pre><p>具体可以参考这篇文章<a href="/2013-11-01-hadoop-1-2-pseudo-distributed-mode/">Hadoop1.2配置伪分布式</a></p>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><hr>
<p>将下载的hadoop-2.4.1移动到<code>/home/letian/hadoop-2.4.1</code>中。在<code>/home/letian/hadoop-env</code>建立目录<code>2.4.1</code>，并在这个目录下建立目录<code>namenode</code>和<code>datanode</code>。</p>
<p>在<code>/etc/profile</code>或者<code>~/.zshrc</code>下添加下面的内容：</p>
<pre><code># set hadoop 2.4.1
export HADOOP_PREFIX=/home/hadoop-2.4.1
export HADOOP_HOME=$HADOOP_PREFIX
export PATH=$HADOOP_PREFIX/bin:$HADOOP_PREFIX/sbin:$PATH
export HADOOP_MAPRED_HOME=$HADOOP_PREFIX
export HADOOP_COMMON_HOME=$HADOOP_PREFIX
export HADOOP_HDFS_HOME=$HADOOP_PREFIX
export YARN_HOME=$HADOOP_PREFIX
export HADOOP_COMMON_LIB_NATIVE_DIR=${HADOOP_PREFIX}/lib/native
export HADOOP_OPTS=&quot;$HADOOP_OPTS -Djava.library.path=$HADOOP_PREFIX/lib&quot;
</code></pre><p>然后：</p>
<pre><code>$ source /etc/profile
$ source ~/.bashrc
</code></pre><p>在<code>/etc/sysctl.conf</code>中加入下面内容：</p>
<pre><code>net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
</code></pre><p>之后，重启网络：</p>
<pre><code>$ sudo service networking restart
</code></pre><p>如果重启失败，那么重启一下电脑吧。</p>
<h2 id="修改hadoop配置文件"><a href="#修改hadoop配置文件" class="headerlink" title="修改hadoop配置文件"></a>修改hadoop配置文件</h2><hr>
<p> hadoop-2.4.1/etc/hadoop/hdfs-site.xml ：</p>
<pre><code>&lt;configuration&gt;
&lt;property&gt;
 &lt;name&gt;dfs.replication&lt;/name&gt;
 &lt;value&gt;1&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;dfs.name.dir&lt;/name&gt;
    &lt;value&gt;file:///home/letian/hadoop-env/2.4.1/hdfs/namenode&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;dfs.data.dir&lt;/name&gt;
    &lt;value&gt;file:///home/letian/hadoop-env/2.4.1/hdfs/datanode&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>hadoop-2.4.1/etc/hadoop/core-site.xml：</p>
<pre><code>&lt;configuration&gt;
&lt;property&gt;
  &lt;name&gt;fs.default.name&lt;/name&gt;
    &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
  &lt;value&gt;/home/letian/hadoop-env/tmp&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>hadoop-2.4.1/etc/hadoop/yarn-site.xml：</p>
<pre><code>&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.aux-services.mapreduce_shuffle.class&lt;/name&gt;
        &lt;value&gt;org.apache.hadoop.mapred.ShuffleHandler&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;
        &lt;value&gt;localhost:8025&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;
        &lt;value&gt;localhost:8030&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;
        &lt;value&gt;localhost:8050&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>hadoop-2.4.1/etc/hadoop/mapred-site.xml.template ：<br>首先：</p>
<pre><code>$ cp hadoop-2.4.1/etc/hadoop/mapred-site.xml.template hadoop-2.4.1/etc/hadoop/mapred-site.xml
</code></pre><p>然后编辑<code>hadoop-2.4.1/etc/hadoop/mapred-site.xml</code>：</p>
<pre><code>&lt;configuration&gt;
 &lt;property&gt;
  &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
   &lt;value&gt;yarn&lt;/value&gt;
 &lt;/property&gt;
&lt;/configuration&gt;
</code></pre><h2 id="格式化hdfs"><a href="#格式化hdfs" class="headerlink" title="格式化hdfs"></a>格式化hdfs</h2><hr>
<p>下面的命令已经废弃，不建议使用。</p>
<pre><code>$ ./bin/hadoop namenode -format
</code></pre><p>建议使用：</p>
<pre><code>$ ./bin/hdfs namenode -format
</code></pre><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><hr>
<p>然后：</p>
<pre><code>$ start-dfs.sh
$ start-yarn.sh
</code></pre><p>查看运行的任务：</p>
<pre><code>$ jps          
5022 Jps
2883 DataNode
3359 NodeManager
3022 SecondaryNameNode
3258 ResourceManager
2785 NameNode
</code></pre><p>查看NameNode的状态，在浏览器中访问<code>http://localhost:50070/</code>。</p>
<p>查看SecondaryNameNode的状态，在浏览器中访问<code>http://localhost:50090/</code>。</p>
<p>查看正在运行的mapreduce任务，在浏览器中访问<code>http://localhost:8088</code>。</p>
<p>可以通过下面的命令查看启动状态：</p>
<pre><code>zsh &gt;&gt; hadoop dfsadmin -report
DEPRECATED: Use of this script to execute hdfs command is deprecated.
Instead use the hdfs command for it.

14/10/16 15:12:59 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Configured Capacity: 127824457728 (119.05 GB)
Present Capacity: 96126644224 (89.52 GB)
DFS Remaining: 96126595072 (89.52 GB)
DFS Used: 49152 (48 KB)
DFS Used%: 0.00%
Under replicated blocks: 2
Blocks with corrupt replicas: 0
Missing blocks: 0

-------------------------------------------------
Datanodes available: 1 (1 total, 0 dead)

Live datanodes:
Name: 127.0.0.1:50010 (localhost)
Hostname: myhost
Decommission Status : Normal
Configured Capacity: 127824457728 (119.05 GB)
DFS Used: 49152 (48 KB)
Non DFS Used: 31697813504 (29.52 GB)
DFS Remaining: 96126595072 (89.52 GB)
DFS Used%: 0.00%
DFS Remaining%: 75.20%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Last contact: Thu Oct 16 15:12:59 CST 2014
</code></pre><h2 id="测试wordcount"><a href="#测试wordcount" class="headerlink" title="测试wordcount"></a>测试wordcount</h2><hr>
<p>假设目录<code>input</code>下文件<code>test1.txt</code>内容如下：</p>
<pre><code>hello world
</code></pre><p>文件<code>test2.txt</code>内容如下：</p>
<pre><code>hi,world
hello
</code></pre><p>将该目录复制到hdfs下的<code>/data</code>目录下：</p>
<pre><code>$ hadoop dfs -put  input/ /data
</code></pre><p>进入目录<code>hadoop-2.4.1</code>，运行：</p>
<pre><code>$ hadoop jar ./share/hadoop/mapreduce/sources/hadoop-mapreduce-examples-2.4.1-sources.jar org.apache.hadoop.examples.WordCount /data /output
</code></pre><p>删除hdfs下的<code>/data</code>目录：</p>
<pre><code>$ hadoop dfs -rmr /data
</code></pre><p>查看结果：</p>
<pre><code>$ hadoop fs -cat /output/part-r-00000 
hello         2
hi,world    1
world        1
</code></pre><p>删除<code>/data</code>和<code>/output</code>目录：</p>
<pre><code>hadoop dfs -rmr /data
hadoop dfs -rmr /output
</code></pre><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><hr>
<p>1、找不到JAVA_HOME</p>
<pre><code>$ start-dfs.sh 
14/10/16 13:53:02 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Starting namenodes on [localhost]
localhost: Error: JAVA_HOME is not set and could not be found.
localhost: Error: JAVA_HOME is not set and could not be found.
Starting secondary namenodes [0.0.0.0]
0.0.0.0: Error: JAVA_HOME is not set and could not be found.
14/10/16 13:53:12 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
</code></pre><p>说是找不到java_home，没办法，明明已经设置了。<br>在<code>hadoop-2.4.0/etc/hadoop/hadoop-env.sh</code>中设置即可。</p>
<p>2、Unable to load native-hadoop library for your platform</p>
<pre><code>zsh &gt;&gt; start-dfs.sh                   
14/10/16 13:57:56 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Starting namenodes on [localhost]
localhost: starting namenode, logging to /home/letian/hadoop-2.4.0/logs/hadoop-sunlt-namenode-myhost.out
localhost: starting datanode, logging to /home/letian/hadoop-2.4.0/logs/hadoop-sunlt-datanode-myhost.out
Starting secondary namenodes [0.0.0.0]
0.0.0.0: starting secondarynamenode, logging to /home/letian/hadoop-2.4.0/logs/hadoop-sunlt-secondarynamenode-myhost.out
14/10/16 13:58:18 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
</code></pre><p>出现了一个<code>WARN</code>，原因可见：<a href="http://stackoverflow.com/questions/19943766/hadoop-unable-to-load-native-hadoop-library-for-your-platform-error-on-centos" target="_blank" rel="external">http://stackoverflow.com/questions/19943766/hadoop-unable-to-load-native-hadoop-library-for-your-platform-error-on-centos</a>。</p>
<p>3、SSH 拒绝连接</p>
<p>我这边是重启电脑后就没问题了。</p>
<p>4、无法访问<code>http://localhost:50070/</code></p>
<pre><code>$ stop-all.sh
$ rm -r /tmp/hadoop-*
$ hadoop namenode -format
$ start-all.sh
</code></pre><p>5、jps的结果没有Datanode<br>清空namenode、datanode对应的目录，然后重启hadoop试一试。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><hr>
<p><a href="http://hadoop.apache.org/docs/r2.4.1/hadoop-project-dist/hadoop-common/SingleCluster.html#Pseudo-Distributed_Operation" target="_blank" rel="external">Hadoop MapReduce Next Generation - Setting up a Single Node Cluster.</a></p>
<p><a href="http://tecadmin.net/setup-hadoop-2-4-single-node-cluster-on-linux/" target="_blank" rel="external">Steps To Setup Hadoop 2.4.0 (Single Node Cluster) on CentOS/RHEL</a>  </p>
<p><a href="http://dogdogfish.com/2014/04/26/installing-hadoop-2-4-on-ubuntu-14-04/" target="_blank" rel="external">Installing Hadoop 2.4 on Ubuntu 14.04</a>  </p>
<p><a href="http://www.bogotobogo.com/Hadoop/BigData_hadoop_Install_on_ubuntu_single_node_cluster.php" target="_blank" rel="external">adoop 2.4 Installing on Ubuntu 14.04 (Single-Node Cluster) - 2014</a> </p>
<p><a href="http://blog.csdn.net/pelick/article/details/12065147" target="_blank" rel="external">十分钟搭建自己的hadoop2/CDH4集群</a>  </p>
<p><a href="http://blog.csdn.net/haidao2009/article/details/14897813" target="_blank" rel="external">hadoop 2.2 错误总结</a></p>
<p><a href="http://blog.csdn.net/u012432778/article/details/23964873" target="_blank" rel="external">Hadoop-2.4.0安装和wordcount运行验证</a>  </p>
<p><a href="http://www.cnblogs.com/garinzhang/p/3861576.html" target="_blank" rel="external">Hadoop 运行WordCount例子</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-14-python-convert-file-encoding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-14-python-convert-file-encoding/" itemprop="url">使用python转换文件编码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-14T11:06:40+08:00">
                October 14th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在搜狗实验室下载了个<a href="http://www.sogou.com/labs/dl/c.html" target="_blank" rel="external">文本分类语料库</a>，里面的文件有多种编码，需要转换为utf-8。</p>
<h2 id="iconv"><a href="#iconv" class="headerlink" title="iconv"></a>iconv</h2><hr>
<p>第一个想法是使用iconv等linux工具进行转换，但是我随便的挑了一个名为1006.txt的文本，看一下它的编码：</p>
<pre><code>zsh &gt;&gt; file 1006.txt 
1006.txt: ISO-8859 text, with very long lines, with CRLF line terminators
</code></pre><p>在windows下使用notepad++打开该文件，分析出的编码是GB2312。</p>
<p>若指定原编码为iso-8859，iconv直接报错：</p>
<pre><code>zsh &gt;&gt; iconv  -f iso-8859 -t utf-8 1006.txt 
iconv: conversion from `iso-8859&#39; is not supported
Try `iconv --help&#39; or `iconv --usage&#39; for more information.
</code></pre><p>若指定原编码为gb2312，</p>
<pre><code>zsh &gt;&gt; iconv  -f gb2312 -t utf-8 1006.txt  

&amp;nbsp;&amp;nbsp;　　2000多万年前欧洲、美洲大陆板块分离的时候，在北大西洋深处扯出一道裂缝，岩浆从裂缝中喷射而出，形成了冰岛――“地球上最美的一道伤痕”　　

　　乡村教堂是冰岛少见的人文景观。岛民的先祖在830年前跟随海盗船到达冰岛

　　冰岛夏季的极昼现象：午夜时分，太阳在地平线上徘徊不落
　　□曼陀罗　文／图
　　在地广人稀的冰岛不停地走，仿佛走到了世界的尽头。
　　1iconv: illegal input sequence at position 374
</code></pre><p>iconv只处理了一部分就报错了。</p>
<p>暂时没找到解决方法。准备写一个。</p>
<h2 id="使用chardet探测文件编码"><a href="#使用chardet探测文件编码" class="headerlink" title="使用chardet探测文件编码"></a>使用chardet探测文件编码</h2><hr>
<pre><code># !/usr/bin/python
# -*- encoding:utf-8 -*-

import chardet

def detect_file_encoding(file_path):
    &#39;&#39;&#39; 返回文件的编码 &#39;&#39;&#39;
    f = open(file_path, &#39;r&#39;)
    data = f.read()
    predict =  chardet.detect(data)
    f.close()
    return predict[&#39;encoding&#39;]

if __name__ == &#39;__main__&#39;:
    file_path = &#39;./1006.txt&#39;
    print detect_file_encoding(file_path)
</code></pre><p>输出：</p>
<pre><code>GB2312
</code></pre><h2 id="使用codecs库读取文件内容"><a href="#使用codecs库读取文件内容" class="headerlink" title="使用codecs库读取文件内容"></a>使用codecs库读取文件内容</h2><hr>
<pre><code># !/usr/bin/python
# -*- encoding:utf-8 -*-

import codecs
def get_file_content(file_path):
    &#39;&#39;&#39; 获取文件内容，最终为utf-8 &#39;&#39;&#39;
    file_encoding = detect_file_encoding(file_path)
    f = codecs.open(file_path, &#39;r&#39;, file_encoding, errors=&quot;ignore&quot;)
    return f.read()
if __name__ == &#39;__main__&#39;:
    file_path = &#39;./1006.txt&#39;
    print get_file_content(file_path)
</code></pre><p>注意，<code>codecs.open()</code>中必须有<code>errors=&quot;ignore&quot;</code>，否则处理容易中断和报类似下面的错误：</p>
<pre><code>UnicodeDecodeError: &#39;gb2312&#39; codec can&#39;t decode bytes in position 374-375: illegal multibyte sequence
</code></pre><p>上面的代码运行结果和notepad++显示的结果是相同的。</p>
<p>剩下的任务就是将所有的文件转换编码了，在这个过程中遇到了文件编码为None的情况，用file命令看一下：</p>
<pre><code>zsh &gt;&gt; file ./C000008/1789.txt
./C000008/1789.txt: data

zsh &gt;&gt; file ./C000023/1170.txt
./C000023/1170.txt: ISO-8859 text, with very long lines, with CRLF line terminators
</code></pre><p>先不解决了。一共有17912个文档，少这两个也没什么问题。</p>
<p><strong>最终代码：</strong></p>
<pre><code># !/usr/bin/python
# -*- encoding:utf-8 -*-

import chardet, codecs, os

import sys
reload(sys)
sys.setdefaultencoding(&#39;UTF-8&#39;)

def detect_file_encoding(file_path):
    &#39;&#39;&#39; 返回文件的编码 &#39;&#39;&#39;
    f = open(file_path, &#39;r&#39;)
    data = f.read()
    predict =  chardet.detect(data)
    f.close()
    return predict[&#39;encoding&#39;]

def get_file_content(file_path):
    &#39;&#39;&#39; 获取文件内容，最终为utf-8 &#39;&#39;&#39;
    file_encoding = detect_file_encoding(file_path)
    if file_encoding is None:
        return &#39;&#39;
    f = codecs.open(file_path, &#39;r&#39;, file_encoding, errors=&quot;ignore&quot;)
    data = f.read()
    f.close()
    return data

def get_all_file(dir_path):
    &#39;&#39;&#39; 获取 dir_path下的所有文件的路径 &#39;&#39;&#39;
    dir_list = [dir_path]
    file_list = []

    while len(dir_list) != 0:
        # print dir_list
        curr_dir = dir_list.pop(0)
        for path_name in os.listdir(curr_dir):
            full_path = os.path.join(curr_dir, path_name)
            if os.path.isdir(full_path):
                dir_list.append(full_path)
            else:
                file_list.append(full_path)
    return file_list

def write2file(content, file_path):
    &#39;&#39;&#39; 将utf-8编码的content写入文件file_path &#39;&#39;&#39;

    with codecs.open(file_path, &#39;w&#39;, &#39;utf-8&#39;, errors=&#39;ignore&#39;) as f:
        f.write(content)

def del_file(file_path):
    &#39;&#39;&#39; 删除文件 &#39;&#39;&#39;
    os.remove(file_path)


def translate_dir(dir_path):
    &#39;&#39;&#39; 将整个目录下的所有文件转换为utf-8编码 &#39;&#39;&#39;
    for file_path in get_all_file(dir_path):
        # print file_path
        content = get_file_content(file_path)
        del_file(file_path)
        write2file(content, file_path)

def count_encoding_none(dir_path):
    &#39;&#39;&#39; 看看哪些文件的编码为None &#39;&#39;&#39;
    all_num = 0
    none_num = 0
    none_files = []
    for file_path in get_all_file(dir_path):
        print file_path
        encoding = detect_file_encoding(file_path)
        all_num += 1
        if encoding is None:
            none_num += 1
            none_files.append(file_path)
    return all_num, none_num, none_files


if __name__ == &#39;__main__&#39;:
    dir_path = &#39;./&#39;
    translate_dir(dir_path)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.letiantian.me/2014-10-14-hadoop-1-2-1-install-mahout-0-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Letian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/content/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="樂天笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014-10-14-hadoop-1-2-1-install-mahout-0-9/" itemprop="url">在hadoop1.2.1上安装mahout 0.9</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-13T17:27:45+08:00">
                October 13th 2014
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014-10-14</p>
<p>首先安装和配置好hadoop 1.2.1，可以参考<a href="/2013-11-01-hadoop-1-2-pseudo-distributed-mode/">Hadoop1.2配置伪分布式</a>。</p>
<p>在<a href="http://apache.claz.org/mahout/0.9/" target="_blank" rel="external">http://apache.claz.org/mahout/0.9/</a>下载：<br>mahout-distribution-0.9.tar.gz 。</p>
<p>解压，重命名为<code>mahout-0.9</code>，放入家目录下。</p>
<p>在<code>/etc/profile</code>中添加：</p>
<pre><code># for mahout 0.9

export MAHOUT_LOCAL=
export MAHOUT_HOME=/home/letian/mahout-0.9
export HADOOP_CONF_DIR=${HADOOP_HOME}/conf
export MAHOUT_CONF_DIR=${MAHOUT_HOME}/conf
export PATH=$MAHOUT_HOME/bin:$PATH
</code></pre><p>在shell中</p>
<pre><code>source /etc/profile
</code></pre><p>然后，测试是否成功，这个可以参考：</p>
<p><a href="http://gaoxianwei.iteye.com/blog/2028095" target="_blank" rel="external">在Hadoop1.2.1分布式集群环境下安装Mahout0.9框架</a></p>
<p><a href="http://samchu.logdown.com/posts/192574-mahout-09-installation-verification-records" target="_blank" rel="external">Mahout 0.9 安裝 驗證 記錄</a>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/content/images/avatar.jpg"
               alt="Letian" />
          <p class="site-author-name" itemprop="name">Letian</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">209</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/letiantian" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Letian</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "0b5e0b416d0b4d9a845ed9b2e72ddc70",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['[latex]','[/latex]'], ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        },
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


  <!-- highlight -->
  <script src="/highlight/highlight.min.js"></script>
  <link rel="stylesheet" href="/highlight/styles/github.css">

  <script>
    // 高亮
    hljs.initHighlightingOnLoad();
  </script>

</body>
</html>
